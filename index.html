<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="appTitle">DNS制限テスト</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* Tailwind gray-100 */
        }
        .test-status {
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem; /* rounded-lg */
            font-weight: 600;
            display: inline-block;
            font-size: 0.875rem; /* text-sm */
        }
        .success {
            background-color: #d1fae5; /* Tailwind green-100 */
            color: #065f46; /* Tailwind green-800 */
        }
        .failure {
            background-color: #fee2e2; /* Tailwind red-100 */
            color: #991b1b; /* Tailwind red-800 */
        }
        .pending {
            background-color: #fef3c7; /* Tailwind yellow-100 */
            color: #92400e; /* Tailwind yellow-800 */
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6; /* blue-500 */
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* 個別テストボタンのスタイルを更新して見やすくする */
        .single-test-btn {
            /* 新しいスタイル: 目立つ青色、大きいパディング、シャドウを追加 */
            @apply px-4 py-1.5 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-150 shadow-md focus:outline-none focus:ring-2 focus:ring-blue-300;
        }
        .single-test-btn:disabled {
            @apply bg-gray-400 text-gray-700 cursor-not-allowed shadow-none;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl p-6 sm:p-10">
        <!-- Language Switcher -->
        <div class="flex justify-end mb-4">
            <button id="lang-ja" class="lang-btn px-3 py-1 text-sm rounded-lg bg-blue-100 text-blue-800 font-semibold mr-2" data-lang="ja">日本語</button>
            <button id="lang-en" class="lang-btn px-3 py-1 text-sm rounded-lg bg-gray-200 text-gray-700" data-lang="en">English</button>
        </div>
        
        <h1 id="mainTitle" class="text-3xl sm:text-4xl font-bold text-gray-800 mb-4 border-b-2 pb-2">
            DNS制限テストツール
        </h1>
        <p id="descriptionText" class="text-gray-600 mb-8">
            お使いのネットワーク（大学のLANなど）で、各種DNS解決方法が利用可能かテストします。
        </p>

        <!-- DoH Test Section -->
        <section class="mb-8 border border-gray-200 rounded-lg p-4 bg-blue-50">
            <h2 id="dohTitle" class="text-2xl font-semibold text-blue-800 mb-3 flex items-center">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944c6.83-2.924 10.75-2.924 12 0a11.955 11.955 0 01-11.618 17.06c-1.573.189-3.155.289-4.755.289-4.721 0-8.665-1.921-12-5.187m2.382-7.854l4.004 4.004m0 0l4.004-4.004"></path></svg>
                DNS over HTTPS (DoH) テスト (複数プロバイダ)
            </h2>
            <p id="dohDescription" class="text-gray-700 mb-4">
                ブラウザの標準的なHTTPS通信(ポート443)を利用して、複数の外部DoHサーバーに接続できるかをテストします。特定のサーバーのみブロックされているか確認できます。
            </p>
            
            <button id="runAllDohTest" class="w-full sm:w-auto px-6 py-3 bg-blue-600 text-white font-bold rounded-full hover:bg-blue-700 transition duration-150 shadow-md hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-300 active:bg-blue-800 mb-4">
                全テスト実行
            </button>

            <!-- Summary and Toggle Section -->
            <div id="summarySection" class="mb-4 p-4 bg-white border border-gray-200 rounded-lg shadow-md">
                <div id="statusSummary" class="flex justify-around text-center mb-3 space-x-2">
                    <!-- Status counts will go here (Updated by JS) -->
                </div>
                <button id="toggleDetailsButton" class="w-full py-2 text-sm font-semibold rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 transition duration-150">
                    <!-- Text updated by JS -->
                </button>
            </div>


            <!-- Test Results Area (Initial state hidden by default) -->
            <div id="testResultsContainer" class="mt-4 space-y-3 hidden">
                <!-- 結果がJavaScriptによってここに挿入される -->
            </div>
            
        </section>

        <!-- Other DNS Methods Explanation -->
        <section class="mb-8 p-4 border border-gray-200 rounded-lg bg-yellow-50">
            <h2 id="otherDnsTitle" class="text-2xl font-semibold text-yellow-800 mb-3 flex items-center">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                その他のDNS制限について
            </h2>
            
            <div class="space-y-4 text-gray-700">
                <p id="dns53Text">
                    <strong class="font-bold">通常のDNS (ポート53):</strong>
                    ブラウザから直接テストすることはできませんが、外部DNSを設定した機器で名前解決を試すことで確認できます。
                </p>
                <p id="dotText">
                    <strong class="font-bold">DNS over TLS (DoT - ポート853):</strong>
                    ブラウザのセキュリティ制限により、Webページから直接接続可否をテストすることは技術的に不可能です。
                </p>
                <p class="p-3 bg-white border border-yellow-200 rounded-md">
                    <strong id="hintTitle" class="text-yellow-700">【ヒント】</strong>
                    <span id="hintContent">ポート53/853の制限を確認したい場合は、PCやスマートフォンでVPNサービスやカスタムDNS設定を有効にし、ウェブサイトが正常に表示されるか（名前解決ができるか）を確認するのが最も確実な方法です。</span>
                </p>
            </div>
        </section>

        <footer class="text-center mt-8 pt-4 border-t border-gray-200">
            <p id="footerText" class="text-sm text-gray-500">
                これはクライアント側のJavaScriptテストであり、ネットワークの完全な状態を示すものではありません。
            </p>
        </footer>
    </div>

    <script type="text/javascript">
        // DoHテストのステータスを追跡するためのグローバル変数
        let dohTestStatuses = {}; 

        // 言語設定の定数
        const LANGUAGES = {
            ja: {
                appTitle: "DNS制限テストツール",
                mainTitle: "DNS制限テストツール",
                descriptionText: "お使いのネットワーク（大学のLANなど）で、各種DNS解決方法が利用可能かテストします。",
                dohTitle: "DNS over HTTPS (DoH) テスト (複数プロバイダ)",
                dohDescription: "ブラウザの標準的なHTTPS通信(ポート443)を利用して、複数の外部DoHサーバーに接続できるかをテストします。特定のサーバーのみブロックされているか確認できます。",
                runAllButton: "全テスト実行",
                otherDnsTitle: "その他のDNS制限について",
                dns53Title: "通常のDNS (ポート53):",
                dns53Content: "ブラウザから直接テストすることはできませんが、外部DNSを設定した機器で名前解決を試すことで確認できます。",
                dotTitle: "DNS over TLS (DoT - ポート853):",
                dotContent: "ブラウザのセキュリティ制限により、Webページから直接接続可否をテストすることは技術的に不可能です。",
                hintTitle: "【ヒント】",
                hintContent: "ポート53/853の制限を確認したい場合は、PCやスマートフォンでVPNサービスやカスタムDNS設定を有効にし、ウェブサイトが正常に表示されるか（名前解決ができるか）を確認するのが最も確実な方法です。",
                footerText: "これはクライアント側のJavaScriptテストであり、ネットワークの完全な状態を示すものではありません。",
                status: {
                    pending: "未実行",
                    testing: "テスト中...",
                    available: "利用可能 (成功)",
                    unavailable: "利用不可 (失敗)",
                    runSingle: "テスト実行",
                    showDetails: "詳細リストを表示", // NEW
                    hideDetails: "詳細リストを非表示", // NEW
                    detailTesting: "外部DoHサーバーにHTTPSリクエストを送信中...",
                    detailSuccess: (duration, status) => `接続成功。レスポンスタイム: ${duration}ms。DNS応答ステータス: ${status}`,
                    detailErrorHttp: (status) => `サーバーに到達しましたが、HTTPエラーが発生しました。ステータス: ${status}`,
                    detailErrorDns: (status) => `応答あり（${status}）ですが、DNSデータとして認識できませんでした。`,
                    detailErrorNetwork: (error, duration) => `接続失敗（ネットワークエラー）。DoH通信がブロックされている可能性が高いです。エラー: ${error}。時間: ${duration}ms。`
                }
            },
            en: {
                appTitle: "DNS Restriction Test Tool",
                mainTitle: "DNS Restriction Test Tool",
                descriptionText: "Test whether various DNS resolution methods are available on your network (e.g., university LAN).",
                dohTitle: "DNS over HTTPS (DoH) Test (Multiple Providers)",
                dohDescription: "Tests connectivity to multiple external DoH servers using standard HTTPS (Port 443). Helps determine if specific servers are blocked.",
                runAllButton: "Run All Tests",
                otherDnsTitle: "About Other DNS Restrictions",
                dns53Title: "Traditional DNS (Port 53):",
                dns53Content: "Cannot be tested directly from the browser, but can be checked by trying name resolution on a device configured with external DNS.",
                dotTitle: "DNS over TLS (DoT - Port 853):",
                dotContent: "Directly testing connectivity from a webpage is technically impossible due to browser security restrictions.",
                hintTitle: "【Hint】",
                hintContent: "To check restrictions on ports 53/853, the surest method is to enable a VPN service or custom DNS settings on your PC or smartphone and verify if websites load correctly (if name resolution works).",
                footerText: "This is a client-side JavaScript test and does not represent the full state of the network.",
                status: {
                    pending: "Pending",
                    testing: "DNS Connecting...",
                    available: "Available (Success)",
                    unavailable: "Unavailable (Failure)",
                    runSingle: "Run Test",
                    showDetails: "Show Details List", // NEW
                    hideDetails: "Hide Details List", // NEW
                    detailTesting: "Sending DoH query...",
                    detailSuccess: (duration, status) => `Connection successful. Response time: ${duration}ms. DNS response status: ${status}`,
                    detailErrorHttp: (status) => `Server reached, but HTTP error occurred. Status: ${status}`,
                    detailErrorDns: (status) => `Response received (${status}), but not recognized as DNS data.`,
                    detailErrorNetwork: (error, duration) => `Connection failed (Network Error). DoH communication is likely blocked. Error: ${error}. Time: ${duration}ms.`
                }
            }
        };

        let currentLang = 'ja';

        document.addEventListener('DOMContentLoaded', () => {
            const runAllDohTestButton = document.getElementById('runAllDohTest');
            const resultsContainer = document.getElementById('testResultsContainer');
            const langButtons = document.querySelectorAll('.lang-btn');
            const toggleDetailsButton = document.getElementById('toggleDetailsButton');

            // DoHテストに使用するパブリックDNSエンドポイントのリスト
            // example.comのAレコードを問い合わせる
            const DOH_ENDPOINTS = [
                { id: 'google', name: "Google Public DNS", url: "https://dns.google/resolve?name=example.com&type=A" },
                { id: 'cloudflare', name: "Cloudflare DNS", url: "https://cloudflare-dns.com/dns-query?name=example.com&type=A" },
                { id: 'quad9', name: "Quad9 DNS", url: "https://dns.quad9.net/dns-query?name=example.com&type=A" },
                { id: 'adguard_default', name: "AdGuard DNS (Default)", url: "https://dns.adguard.com/dns-query?name=example.com&type=A" },
                { id: 'adguard_family', name: "AdGuard DNS (Family Protection)", url: "https://dns-family.adguard.com/dns-query?name=example.com&type=A" },
                { id: 'cleanbrowsing', name: "CleanBrowsing (Family)", url: "https://doh.cleanbrowsing.org/doh/family/?name=example.com&type=A" },
                { id: 'nextdns', name: "NextDNS (General)", url: "https://dns.nextdns.io/dns-query?name=example.com&type=A" },
                { id: 'control_d', name: "ControlD (Default)", url: "https://freedns.controld.com/p1?name=example.com&type=A" },
                { id: 'tailscale_tsnet', name: "Tailscale Funnel/Public", url: "https://ts.net/dns-query?name=example.com&type=A" }
            ];

            // UIテキストを現在の言語に更新する関数
            function updateUI(lang) {
                const text = LANGUAGES[lang];
                document.getElementById('appTitle').textContent = text.appTitle;
                document.getElementById('mainTitle').textContent = text.mainTitle;
                document.getElementById('descriptionText').textContent = text.descriptionText;
                document.getElementById('dohTitle').innerHTML = `<svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944c6.83-2.924 10.75-2.924 12 0a11.955 11.955 0 01-11.618 17.06c-1.573.189-3.155.289-4.755.289-4.721 0-8.665-1.921-12-5.187m2.382-7.854l4.004 4.004m0 0l4.004-4.004"></path></svg>${text.dohTitle}`;
                document.getElementById('dohDescription').textContent = text.dohDescription;
                runAllDohTestButton.textContent = text.runAllButton;
                document.getElementById('otherDnsTitle').innerHTML = `<svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>${text.otherDnsTitle}`;
                
                document.getElementById('dns53Text').innerHTML = `<strong class="font-bold">${text.dns53Title}</strong> ${text.dns53Content}`;
                document.getElementById('dotText').innerHTML = `<strong class="font-bold">${text.dotTitle}</strong> ${text.dotContent}`;
                document.getElementById('hintTitle').textContent = text.hintTitle;
                document.getElementById('hintContent').textContent = text.hintContent;
                document.getElementById('footerText').textContent = text.footerText;

                // 言語ボタンのアクティブ状態を更新
                langButtons.forEach(button => {
                    if (button.dataset.lang === lang) {
                        button.classList.remove('bg-gray-200', 'text-gray-700');
                        button.classList.add('bg-blue-100', 'text-blue-800', 'font-semibold');
                    } else {
                        button.classList.remove('bg-blue-100', 'text-blue-800', 'font-semibold');
                        button.classList.add('bg-gray-200', 'text-gray-700');
                    }
                });
                
                // 結果表示エリアを再初期化して、新しい言語のテキストを反映させる
                initializeResults();
                updateSummary(); // サマリーテキストも更新
            }

            // 初期表示用のHTMLを生成し、個別テストボタンを追加
            function initializeResults() {
                const text = LANGUAGES[currentLang];
                resultsContainer.innerHTML = DOH_ENDPOINTS.map(endpoint => {
                    // 内部ステータスを初期化
                    dohTestStatuses[endpoint.id] = { result: 'pending', duration: null, status: null, error: null };
                    
                    return `
                        <div id="result-${endpoint.id}" class="p-3 border rounded-lg bg-white">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-gray-800">${endpoint.name}</span>
                                <div class="flex items-center space-x-2">
                                    <span id="status-${endpoint.id}" class="test-status pending">${text.status.pending}</span>
                                    <button id="run-single-${endpoint.id}" class="single-test-btn">
                                        ${text.status.runSingle}
                                    </button>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1 break-all">${endpoint.url}</p>
                            <p id="details-${endpoint.id}" class="text-xs text-gray-500 mt-1"></p>
                        </div>
                    `;
                }).join('');

                // 個別テストボタンにイベントリスナーを設定
                DOH_ENDPOINTS.forEach(endpoint => {
                    const singleRunButton = document.getElementById(`run-single-${endpoint.id}`);
                    if (singleRunButton) {
                        singleRunButton.addEventListener('click', () => runSingleTest(endpoint.id));
                    }
                });
            }
            
            /**
             * テストサマリーセクションを更新します。
             */
            function updateSummary() {
                const counts = { pending: 0, success: 0, failure: 0 };
                const text = LANGUAGES[currentLang];
                
                Object.values(dohTestStatuses).forEach(status => {
                    if (status.result === 'success') {
                        counts.success++;
                    } else if (status.result === 'failure') {
                        counts.failure++;
                    } else {
                        counts.pending++;
                    }
                });

                const total = DOH_ENDPOINTS.length;
                const completed = counts.success + counts.failure;
                
                // 概要表示を更新
                const summaryHtml = `
                    <div class="flex flex-col items-center">
                        <span class="text-sm font-bold text-gray-700">${completed} / ${total}</span>
                        <span class="text-xs text-gray-500">完了</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span class="text-sm font-bold text-green-600">${counts.success}</span>
                        <span class="text-xs text-green-600">成功</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span class="text-sm font-bold text-red-600">${counts.failure}</span>
                        <span class="text-xs text-red-600">失敗</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span class="text-sm font-bold text-yellow-600">${counts.pending}</span>
                        <span class="text-xs text-yellow-600">未実行</span>
                    </div>
                `;
                document.getElementById('statusSummary').innerHTML = summaryHtml;
                
                // トグルボタンを更新
                const container = document.getElementById('testResultsContainer');
                const isHidden = container.classList.contains('hidden');
                
                let buttonText;
                if (isHidden) {
                    buttonText = `${text.status.showDetails} (${completed} / ${total})`;
                    toggleDetailsButton.innerHTML = `<svg class="w-4 h-4 mr-2 inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>${buttonText}`;
                } else {
                    buttonText = `${text.status.hideDetails} (${completed} / ${total})`;
                    toggleDetailsButton.innerHTML = `<svg class="w-4 h-4 mr-2 inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>${buttonText}`;
                }
            }
            
            /**
             * 特定のDoHエンドポイントのテストを実行します。
             */
            async function testDohEndpoint(endpoint) {
                const text = LANGUAGES[currentLang];
                const statusElement = document.getElementById(`status-${endpoint.id}`);
                const detailsElement = document.getElementById(`details-${endpoint.id}`);
                const resultDiv = document.getElementById(`result-${endpoint.id}`);
                const singleRunButton = document.getElementById(`run-single-${endpoint.id}`);

                // 実行中にUIを更新
                if (singleRunButton) singleRunButton.disabled = true;
                runAllDohTestButton.disabled = true;

                // 内部ステータスを更新
                dohTestStatuses[endpoint.id].result = 'testing';

                statusElement.innerHTML = `<span class="loading-spinner mr-2"></span>${text.status.testing}`;
                statusElement.className = 'test-status pending flex items-center';
                detailsElement.textContent = text.status.detailTesting;
                resultDiv.classList.remove('border-green-300', 'border-red-300');
                resultDiv.classList.add('border-yellow-300');
                updateSummary(); // サマリーを更新して「テスト中」を反映

                const startTime = performance.now();
                let success = false;
                
                try {
                    const response = await fetch(endpoint.url, { 
                        method: 'GET',
                        cache: 'no-store',
                        credentials: 'omit'
                    });
                    
                    const duration = (performance.now() - startTime).toFixed(2);

                    if (response.ok) {
                        const json = await response.json();
                        
                        if (json && typeof json.Status === 'number') {
                            success = true;
                            detailsElement.textContent = text.status.detailSuccess(duration, json.Status);
                        } else {
                            // 200 OKだがDNS応答形式ではない場合
                            detailsElement.textContent = text.status.detailErrorDns(response.status);
                        }
                    } else {
                        // 4xx, 5xxなどのHTTPエラー
                        detailsElement.textContent = text.status.detailErrorHttp(response.status);
                    }
                    dohTestStatuses[endpoint.id].duration = duration;
                    dohTestStatuses[endpoint.id].status = response.status;

                } catch (error) {
                    // ネットワークレベルのエラー (接続拒否、タイムアウトなど)
                    const duration = (performance.now() - startTime).toFixed(2);
                    detailsElement.textContent = text.status.detailErrorNetwork(error.message, duration);
                    console.error(`DoHテストエラー (${endpoint.name}):`, error);
                    
                    dohTestStatuses[endpoint.id].duration = duration;
                    dohTestStatuses[endpoint.id].error = error.message;
                }

                // UIと内部ステータスを最終結果で更新
                if (success) {
                    dohTestStatuses[endpoint.id].result = 'success';
                    statusElement.textContent = text.status.available;
                    statusElement.className = 'test-status success';
                    resultDiv.classList.remove('border-yellow-300', 'border-red-300');
                    resultDiv.classList.add('border-green-300');
                } else {
                    dohTestStatuses[endpoint.id].result = 'failure';
                    statusElement.textContent = text.status.unavailable;
                    statusElement.className = 'test-status failure';
                    resultDiv.classList.remove('border-yellow-300', 'border-green-300');
                    resultDiv.classList.add('border-red-300');
                }

                updateSummary();
                if (singleRunButton) singleRunButton.disabled = false;
                // 全体テストの実行中でなければ、全体テストボタンを有効化
                if (!document.querySelector('.loading-spinner')) {
                    runAllDohTestButton.disabled = false;
                }
            }
            
            /**
             * 単一のDoHテストを実行します。
             */
            async function runSingleTest(id) {
                const endpoint = DOH_ENDPOINTS.find(e => e.id === id);
                if (endpoint) {
                    await testDohEndpoint(endpoint);
                }
            }

            /**
             * 全てのDoHテストを順番に実行します。
             */
            async function runAllDohTests() {
                runAllDohTestButton.disabled = true;
                
                // 全ての個別ボタンを無効化
                DOH_ENDPOINTS.forEach(e => {
                    const btn = document.getElementById(`run-single-${e.id}`);
                    if (btn) btn.disabled = true;
                });
                
                // 結果表示を初期化（テスト中表示に戻す）
                initializeResults();

                for (const endpoint of DOH_ENDPOINTS) {
                    await testDohEndpoint(endpoint);
                }

                runAllDohTestButton.disabled = false;
                
                // 全ての個別ボタンを有効化
                DOH_ENDPOINTS.forEach(e => {
                    const btn = document.getElementById(`run-single-${e.id}`);
                    if (btn) btn.disabled = false;
                });
            }
            
            /**
             * 詳細リストの表示・非表示を切り替えます。
             */
            function toggleDetails() {
                resultsContainer.classList.toggle('hidden');
                updateSummary(); // ボタンテキストを更新するために呼び出し
            }

            // イベントリスナー設定
            langButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const newLang = button.dataset.lang;
                    if (newLang !== currentLang) {
                        currentLang = newLang;
                        updateUI(currentLang);
                    }
                });
            });

            runAllDohTestButton.addEventListener('click', runAllDohTests);
            toggleDetailsButton.addEventListener('click', toggleDetails); // トグルボタンにイベントリスナーを追加

            // 初期化
            updateUI(currentLang);
        });
    </script>
</body>
</html>
